<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Notepad</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <style>
        .ql-toolbar.ql-snow {
            border: none;
            border-bottom: 1px solid #e2e8f0;
        }
        .ql-container.ql-snow {
            border: none;
        }
        .ql-editor {
            font-size: 16px;
            line-height: 1.6;
        }
        .word-count {
            font-size: 12px;
            color: #718096;
            text-align: right;
            padding: 4px 8px;
            background-color: #f7fafc;
            border-top: 1px solid #e2e8f0;
        }
    </style>
</head>
<body class="bg-gray-100 h-screen flex">
    <div class="flex w-full h-full">
        <!-- Sidebar -->
        <div class="w-64 bg-white border-r border-gray-200 p-4 flex flex-col">
            <h1 class="text-2xl font-bold mb-4 text-gray-800">Notes</h1>
            <button id="newNoteBtn" class="bg-blue-500 text-white py-2 px-4 rounded mb-4 hover:bg-blue-600 transition duration-300">New Note</button>
            <ul id="noteList" class="overflow-y-auto flex-grow"></ul>
        </div>

        <!-- Main content -->
        <div class="flex-grow flex flex-col bg-white">
            <div class="p-4 border-b border-gray-200">
                <input id="noteTitle" type="text" placeholder="Note Title" class="w-full text-xl font-semibold outline-none text-gray-800">
            </div>
            <div id="editor" class="flex-grow"></div>
            <div id="wordCount" class="word-count"></div>
        </div>
    </div>

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        let db;
        let currentNoteId = null;

        // Initialize IndexedDB
        const request = indexedDB.open('NotepadDB', 1);

        request.onerror = (event) => {
            console.error("IndexedDB error:", event.target.error);
        };

        request.onsuccess = (event) => {
            db = event.target.result;
            loadNotes();
        };

        request.onupgradeneeded = (event) => {
            db = event.target.result;
            const objectStore = db.createObjectStore('notes', { keyPath: 'id', autoIncrement: true });
            objectStore.createIndex('title', 'title', { unique: false });
        };

        // Initialize Quill editor
        const quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, false] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    ['blockquote', 'code-block'],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    [{ 'script': 'sub'}, { 'script': 'super' }],
                    [{ 'indent': '-1'}, { 'indent': '+1' }],
                    [{ 'color': [] }, { 'background': [] }],
                    ['image', 'link'],
                    ['clean']
                ]
            }
        });

        // Word count feature
        function updateWordCount() {
            const text = quill.getText();
            const words = text.trim().split(/\s+/).length;
            document.getElementById('wordCount').textContent = `Words: ${words}`;
        }

        quill.on('text-change', debounce(() => {
            updateWordCount();
            saveNote();
        }, 500));

        // Initial word count
        updateWordCount();

        // Event Listeners
        document.getElementById('newNoteBtn').addEventListener('click', createNewNote);
        document.getElementById('noteTitle').addEventListener('input', debounce(saveNote, 500));
        quill.on('text-change', debounce(saveNote, 500));

        function createNewNote() {
            currentNoteId = null;
            document.getElementById('noteTitle').value = '';
            quill.setContents([]);
            saveNote();
        }

        function saveNote() {
            const title = document.getElementById('noteTitle').value;
            const content = quill.getContents();

            const transaction = db.transaction(['notes'], 'readwrite');
            const objectStore = transaction.objectStore('notes');

            const note = {
                title: title,
                content: content
            };

            if (currentNoteId !== null) {
                note.id = currentNoteId;
                objectStore.put(note);
            } else {
                objectStore.add(note).onsuccess = (event) => {
                    currentNoteId = event.target.result;
                };
            }

            transaction.oncomplete = () => {
                loadNotes();
            };
        }

        function loadNotes() {
            const transaction = db.transaction(['notes'], 'readonly');
            const objectStore = transaction.objectStore('notes');
            const request = objectStore.getAll();

            request.onsuccess = (event) => {
                const notes = event.target.result;
                const noteList = document.getElementById('noteList');
                noteList.innerHTML = '';

                notes.forEach(note => {
                    const li = document.createElement('li');
                    li.className = 'mb-2 flex items-center justify-between';
                    li.innerHTML = `
                        <span class="cursor-pointer hover:text-blue-500">${note.title || 'Untitled'}</span>
                        <i class="bi bi-trash text-red-500 cursor-pointer hidden"></i>
                    `;
                    li.querySelector('span').addEventListener('click', () => loadNote(note.id));
                    li.querySelector('i').addEventListener('click', (e) => {
                        e.stopPropagation();
                        deleteNote(note.id);
                    });
                    li.addEventListener('mouseenter', () => li.querySelector('i').classList.remove('hidden'));
                    li.addEventListener('mouseleave', () => li.querySelector('i').classList.add('hidden'));
                    noteList.appendChild(li);
                });
            };
        }

        function loadNote(id) {
            const transaction = db.transaction(['notes'], 'readonly');
            const objectStore = transaction.objectStore('notes');
            const request = objectStore.get(id);

            request.onsuccess = (event) => {
                const note = event.target.result;
                currentNoteId = note.id;
                document.getElementById('noteTitle').value = note.title;
                quill.setContents(note.content);
            };
        }

        function deleteNote(id) {
            if (confirm('Are you sure you want to delete this note?')) {
                const transaction = db.transaction(['notes'], 'readwrite');
                const objectStore = transaction.objectStore('notes');
                objectStore.delete(id);

                transaction.oncomplete = () => {
                    if (currentNoteId === id) {
                        createNewNote();
                    }
                    loadNotes();
                };
            }
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>
